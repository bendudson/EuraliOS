* Address Resolution Protocol (ARP)

The most basic level of IP networking is the [[https://en.wikipedia.org/wiki/Link_layer][link layer]], i.e ethernet
cards with physical harware addresses. The protocol used to discover
the hardware (MAC) address associated with an IP address on the local
network is the [[https://en.wikipedia.org/wiki/Address_Resolution_Protocol][Address Resolution Protocol (ARP)]].

** Sending packet data

QEMU's networking https://wiki.qemu.org/Documentation/Networking
Guest assigned IPs starting 10.0.2.15. Gateway at 10.0.2.2.

Saves in [[https://wiki.wireshark.org/Development/LibpcapFileFormat][libpcap format]]

#+begin_src toml
  run-args = ["-netdev", "user,id=u1", "-device", "rtl8139,netdev=u1", "-object", "filter-dump,id=f1,netdev=u1,file=dump.dat"]
#+end_src


** ARP

smoltcp code to handle [[https://docs.rs/smoltcp/latest/src/smoltcp/wire/arp.rs.html][arp packets]] and ethernet frames

#+begin_src bash
  $ tcpdump -r dump.dat
  reading from file dump.dat, link-type EN10MB (Ethernet), snapshot length 65536
  18:42:39.511872 ARP, Request who-has 10.0.2.2 tell 10.0.2.15, length 28
  18:42:39.511935 ARP, Reply 10.0.2.2 is-at 52:55:0a:00:02:02 (oui Unknown), length 50
#+end_src

#+CAPTION: Sending an =ARP= broadcast request and receiving a reply from the QEMU gateway
#+NAME: fig-arp
[[./img/16-01-arp.png]]

